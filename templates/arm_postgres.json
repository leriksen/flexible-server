{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "active_directory_auth": {
      "type": "String"
    },
    "administrator_login": {
      "type": "String"
    },
    "administrator_login_password": {
      "type": "String"
    },
    "availability_zone": {
      "type": "String"
    },
    "backup_retention_days": {
      "type": "String"
    },
    "cluster_size": {
      "type": "String",
      "defaultValue": ""
    },
    "cmk_assigned_identity": {
      "type": "String"
    },
    "cmk_encryption_type": {
      "type": "String"
    },
    "cmk_key_uri": {
      "type": "String"
    },
    "create_mode": {
      "type": "String"
    },
    "geo_redundant_backup": {
      "type": "String"
    },
    "ha_mode": {
      "type": "String"
    },
    "identity_type": {
      "type": "String"
    },
    "location": {
      "type": "String"
    },
    "name": {
      "type": "String"
    },
    "password_auth": {
      "type": "String"
    },
    "public_network_access": {
      "type": "String"
    },
    "replication_role": {
      "type": "String"
    },
    "sku_name": {
      "type": "String"
    },
    "sku_tier": {
      "type": "String"
    },
    "source_server_id": {
      "type": "String"
    },
    "standby_availability_zone": {
      "type": "String"
    },
    "storage_autogrow": {
      "type": "String"
    },
    "storage_iops": {
      "type": "String"
    },
    "storage_size_gb": {
      "type": "String"
    },
    "storage_tier": {
      "type": "String"
    },
    "storage_throughput": {
      "type": "String"
    },
    "storage_type": {
      "type": "String"
    },
    "tenant_id": {
      "type": "String"
    },
    "version": {
      "type": "String"
    }
  },
  "variables": {},
  "resources": [
    {
      "type"      : "Microsoft.DBforPostgreSQL/flexibleServers",
      "apiVersion": "2025-01-01-preview",
      "name"      : "[parameters('name')]",
      "location"  : "[parameters('location')]",
      "sku": {
        "name": "[parameters('sku_name')]",
        "tier": "[parameters('sku_tier')]"
      },
      "identity": {
        "type": "[parameters('identity_type')]",
        "userAssignedIdentities": {
          "[parameters('cmk_assigned_identity')]": {}
        }
      },
      "properties": {
        "administratorLogin": "[parameters('administrator_login')]",
        "administratorLoginPassword": "[parameters('administrator_login_password')]",
        "authConfig": {
          "activeDirectoryAuth": "[parameters('active_directory_auth')]",
          "passwordAuth"       : "[parameters('password_auth')]",
          "tenantId"           : "[parameters('tenant_id')]"
        },
        "availabilityZone": "[parameters('availability_zone')]",
        "createMode"    : "[parameters('create_mode')]",
        "network": {
          "publicNetworkAccess": "[parameters('public_network_access')]"
        },
        "storage": {
          "storageSizeGB": "[parameters('storage_size_gb')]",
          "type"         : "[parameters('storage_type')]"
        },
        "version": "[parameters('version')]"
      }
    }
  ],
  "outputs": {
    "highAvailability": {
      "type": "Object",
      "value": "[reference(resourceId('Microsoft.DBforPostgreSQL/flexibleServers', parameters('name')), '2025-01-01-preview', 'Full').properties.highAvailability]"
    }
  }
}